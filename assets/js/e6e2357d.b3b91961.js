"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[3506],{2400:(e,s,a)=>{a.r(s),a.d(s,{default:()=>f});var r=a(6540),i=a(351),t=a(1899),n=a(4213),l=a(4848);const c=({message:e,onDismiss:s,showIcon:a=!0})=>(0,l.jsxs)("div",{className:"error-message-container",children:[a&&(0,l.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,l.jsx)("span",{className:"error-message-text",children:e}),s&&(0,l.jsx)("button",{className:"error-dismiss-button",onClick:s,"aria-label":"Dismiss error",children:"\xd7"})]}),o=({size:e="medium",centered:s=!1,message:a="Loading..."})=>{const r=`spinner-${e}`,i=s?"spinner-centered":"";return(0,l.jsxs)("div",{className:`spinner-container ${i}`,children:[(0,l.jsx)("div",{className:`loading-spinner ${r}`}),a&&(0,l.jsx)("p",{className:"spinner-message",children:a})]})},d=({userId:e})=>{const{user:s,loading:a,updateProfile:i}=(0,t.h)(),[d,m]=(0,r.useState)(null),[u,h]=(0,r.useState)({first_name:"",last_name:"",display_name:"",avatar_url:"",bio:"",theme:"light",notifications:{email:!0,push:!0}}),[p,f]=(0,r.useState)({}),[g,x]=(0,r.useState)(!0),[v,_]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),[y,N]=(0,r.useState)("");(0,r.useEffect)(()=>{!a&&s&&(async()=>{try{s&&(m(s),h({first_name:s.profile?.first_name||"",last_name:s.profile?.last_name||"",display_name:s.profile?.display_name||"",avatar_url:s.profile?.avatar_url||"",bio:s.profile?.bio||"",theme:s.profile?.preferences?.theme||"light",notifications:s.profile?.preferences?.notifications||{email:!0,push:!0}}))}catch(e){N(e.message||"Failed to load profile")}finally{x(!1)}})()},[s,a]);const w=e=>{const{name:s,value:a,type:r}=e.target;if("checkbox"===r){const a=e.target,[r,i]=s.split(".");h(i?e=>{const s=e[r];return"object"==typeof s&&null!==s?{...e,[r]:{...s,[i]:a.checked}}:{...e,[r]:{[i]:a.checked}}}:e=>({...e,[s]:a.checked}))}else h(e=>({...e,[s]:a}));p[s]&&f(e=>{const a={...e};return delete a[s],a})};return a||g?(0,l.jsx)(o,{centered:!0,message:"Loading profile..."}):s?(0,l.jsxs)("div",{className:"user-profile-container",children:[(0,l.jsx)("h2",{children:"User Profile"}),y&&(0,l.jsx)(c,{message:y}),j&&(0,l.jsx)("div",{className:"alert alert--success",role:"alert",children:"Profile updated successfully!"}),(0,l.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};if(u.first_name){const s=(0,n.yS)(u.first_name);s.isValid||(e.first_name=s.message||"")}if(u.last_name){const s=(0,n.yS)(u.last_name);s.isValid||(e.last_name=s.message||"")}if(u.display_name){const s=(0,n.G4)(u.display_name);s.isValid||(e.display_name=s.message||"")}const s=(0,n.xV)(u.bio);if(s.isValid||(e.bio=s.message||""),u.avatar_url){const s=(0,n.wv)(u.avatar_url);s.isValid||(e.avatar_url=s.message||"")}return f(e),0===Object.keys(e).length})()){_(!0),N(""),b(!1);try{await i({first_name:u.first_name,last_name:u.last_name,display_name:u.display_name,avatar_url:u.avatar_url,bio:u.bio,preferences:{theme:u.theme,notifications:u.notifications}})&&b(!0)}catch(s){N(s.message||"Failed to update profile")}finally{_(!1)}}},className:"profile-form",children:[(0,l.jsxs)("div",{className:"form-row",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"first_name",children:"First Name"}),(0,l.jsx)("input",{type:"text",id:"first_name",name:"first_name",value:u.first_name,onChange:w,className:"form-control "+(p.first_name?"error":""),placeholder:"Your first name"}),p.first_name&&(0,l.jsx)("div",{className:"error-message",children:p.first_name})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"last_name",children:"Last Name"}),(0,l.jsx)("input",{type:"text",id:"last_name",name:"last_name",value:u.last_name,onChange:w,className:"form-control "+(p.last_name?"error":""),placeholder:"Your last name"}),p.last_name&&(0,l.jsx)("div",{className:"error-message",children:p.last_name})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"display_name",children:"Display Name"}),(0,l.jsx)("input",{type:"text",id:"display_name",name:"display_name",value:u.display_name,onChange:w,className:"form-control "+(p.display_name?"error":""),placeholder:"How you'd like to be known"}),p.display_name&&(0,l.jsx)("div",{className:"error-message",children:p.display_name})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"email",children:"Email"}),(0,l.jsx)("input",{type:"email",id:"email",name:"email",value:s.email||"",disabled:!0,className:"form-control"}),(0,l.jsx)("small",{className:"form-text",children:"Email cannot be changed here. Contact support to update your email."})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"avatar_url",children:"Avatar URL"}),(0,l.jsx)("input",{type:"text",id:"avatar_url",name:"avatar_url",value:u.avatar_url,onChange:w,className:"form-control "+(p.avatar_url?"error":""),placeholder:"URL to your profile picture"}),p.avatar_url&&(0,l.jsx)("div",{className:"error-message",children:p.avatar_url})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"bio",children:"Bio"}),(0,l.jsx)("textarea",{id:"bio",name:"bio",value:u.bio,onChange:w,className:"form-control "+(p.bio?"error":""),placeholder:"Tell us about yourself",rows:4}),p.bio&&(0,l.jsx)("div",{className:"error-message",children:p.bio}),(0,l.jsx)("small",{className:"form-text",children:"Maximum 500 characters"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"theme",children:"Theme Preference"}),(0,l.jsxs)("select",{id:"theme",name:"theme",value:u.theme,onChange:e=>{const{name:s,value:a}=e.target;h(e=>({...e,[s]:a}))},className:"form-control",children:[(0,l.jsx)("option",{value:"light",children:"Light"}),(0,l.jsx)("option",{value:"dark",children:"Dark"})]})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("h3",{children:"Notification Preferences"}),(0,l.jsx)("div",{className:"checkbox-group",children:(0,l.jsxs)("label",{className:"checkbox-label",children:[(0,l.jsx)("input",{type:"checkbox",name:"notifications.email",checked:u.notifications.email,onChange:w}),"Email notifications"]})}),(0,l.jsx)("div",{className:"checkbox-group",children:(0,l.jsxs)("label",{className:"checkbox-label",children:[(0,l.jsx)("input",{type:"checkbox",name:"notifications.push",checked:u.notifications.push,onChange:w}),"Push notifications"]})})]}),(0,l.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:v,children:v?"Saving...":"Save Changes"}),v&&(0,l.jsx)(o,{size:"small",message:"Saving profile..."})]})]}):(0,l.jsx)("div",{children:"Please sign in to view your profile."})};var m=a(4406),u=a(9944);class h{static async hasAccess(e,s,a="view"){try{const{data:r,error:i}=await u.ND.from("content").select("access_level").eq("id",s).eq("is_public",!0).single();if(!i&&r)return!0;const{data:t,error:n}=await u.ND.from("content_access").select("*").eq("user_id",e).eq("content_id",s).gte("access_level",this.getAccessLevelValue(a)).single();return n?(console.error("Error checking content access:",n),!1):!!t}catch(r){return console.error("Error in hasAccess:",r),!1}}static async getUserAccessLevel(e,s){try{const{data:a,error:r}=await u.ND.from("content").select("access_level").eq("id",s).eq("is_public",!0).single();if(!r&&a)return"view";const{data:i,error:t}=await u.ND.from("content_access").select("access_level").eq("user_id",e).eq("content_id",s).single();return t||!i?"none":i.access_level}catch(a){return console.error("Error getting user access level:",a),"none"}}static async grantAccess(e,s,a){try{const{error:r}=await u.ND.from("content_access").upsert({user_id:e,content_id:s,access_level:a,granted_at:(new Date).toISOString()},{onConflict:"user_id,content_id"});return!r||(console.error("Error granting content access:",r),!1)}catch(r){return console.error("Error in grantAccess:",r),!1}}static hasRole(e,s){return!!e&&e.role===s}static isAdmin(e){return this.hasRole(e,"admin")}static hasPremiumAccess(e){return!!e&&["premium","admin"].includes(e.role)}static hasInstructorAccess(e){return!!e&&["instructor","admin"].includes(e.role)}static getAccessLevelValue(e){switch(e){case"view":return 1;case"edit":return 2;case"admin":return 3;default:return 0}}}const p=({children:e,requiredRole:s="authenticated",requiredAccessLevel:a="view",contentId:r,fallback:i=(0,l.jsx)("div",{children:"Please log in to access this content."}),redirectPath:n="/signin"})=>{const{user:c,loading:o,isAuthenticated:d}=(0,t.h)();if(o)return(0,l.jsx)("div",{children:"Loading..."});if(!d||!c)return i||(0,l.jsxs)("div",{children:["Please ",(0,l.jsx)("a",{href:(0,m.fO)(n),children:"log in"})," to access this content."]});if(s&&"authenticated"!==s){if("admin"===s&&!h.isAdmin(c))return(0,l.jsx)("div",{children:"You don't have administrator permission to access this content."});if("premium"===s&&!h.hasPremiumAccess(c))return(0,l.jsx)("div",{children:"You need a premium account to access this content."});if("instructor"===s&&!h.hasInstructorAccess(c))return(0,l.jsx)("div",{children:"You need instructor access to view this content."});if("admin"!==s&&"premium"!==s&&"instructor"!==s&&c.role!==s)return(0,l.jsx)("div",{children:"You don't have permission to access this content."})}return(0,l.jsx)(l.Fragment,{children:e})},f=()=>(0,l.jsx)(i.A,{title:"User Profile",description:"Manage your account profile and preferences",children:(0,l.jsx)("div",{className:"container margin-vert--lg",children:(0,l.jsx)("div",{className:"row",children:(0,l.jsx)("div",{className:"col col--8 col--offset-2",children:(0,l.jsxs)("div",{className:"card",children:[(0,l.jsxs)("div",{className:"card__header",children:[(0,l.jsx)("h1",{children:"Your Profile"}),(0,l.jsx)("p",{children:"Manage your account information and preferences"})]}),(0,l.jsx)("div",{className:"card__body",children:(0,l.jsx)(p,{requiredRole:"authenticated",children:(0,l.jsx)(d,{})})})]})})})})})},4213:(e,s,a)=>{a.d(s,{DT:()=>r,G4:()=>l,Oj:()=>i,nY:()=>t,wv:()=>c,xV:()=>o,yS:()=>n});const r=e=>{if(!e)return{isValid:!1,message:"Email is required"};return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?{isValid:!0}:{isValid:!1,message:"Please enter a valid email address"}},i=e=>e?e.length<8?{isValid:!1,message:"Password must be at least 8 characters long"}:e.length>128?{isValid:!1,message:"Password must be less than 128 characters"}:/[A-Z]/.test(e)?/[a-z]/.test(e)?/\d/.test(e)?/[!@#$%^&*(),.?":{}|<>]/.test(e)?{isValid:!0}:{isValid:!1,message:"Password must contain at least one special character"}:{isValid:!1,message:"Password must contain at least one number"}:{isValid:!1,message:"Password must contain at least one lowercase letter"}:{isValid:!1,message:"Password must contain at least one uppercase letter"}:{isValid:!1,message:"Password is required"},t=(e,s)=>e!==s?{isValid:!1,message:"Passwords do not match"}:{isValid:!0},n=e=>{if(!e)return{isValid:!1,message:"Name is required"};if(e.length<2)return{isValid:!1,message:"Name must be at least 2 characters long"};if(e.length>50)return{isValid:!1,message:"Name must be less than 50 characters"};return/^[a-zA-Z\s\-']+$/.test(e)?{isValid:!0}:{isValid:!1,message:"Name can only contain letters, spaces, hyphens, and apostrophes"}},l=e=>{if(!e)return{isValid:!1,message:"Display name is required"};if(e.length<3)return{isValid:!1,message:"Display name must be at least 3 characters long"};if(e.length>30)return{isValid:!1,message:"Display name must be less than 30 characters"};return/^[a-zA-Z0-9\s\-_.]+$/.test(e)?{isValid:!0}:{isValid:!1,message:"Display name can only contain letters, numbers, spaces, hyphens, underscores, and periods"}},c=e=>{if(!e)return{isValid:!0};try{return new URL(e),{isValid:!0}}catch{return{isValid:!1,message:"Please enter a valid URL"}}},o=e=>e.length>500?{isValid:!1,message:"Bio must be less than 500 characters"}:{isValid:!0}},4406:(e,s,a)=>{a.d(s,{fO:()=>r});const r=(e,s)=>{const a=s||("undefined"!=typeof window?window.location.pathname+window.location.search:"/");if(a.includes("/signin")||a.includes("/signup")||a.includes("/auth"))return e;const r=encodeURIComponent(a),i=e.includes("?")?"&":"?";return`${e}${i}returnUrl=${r}`}}}]);