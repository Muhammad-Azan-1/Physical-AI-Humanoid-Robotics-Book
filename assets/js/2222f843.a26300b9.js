"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[4166],{5032:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"authentication-enhancements","title":"Authentication Enhancements","description":"Overview","source":"@site/docs/authentication-enhancements.md","sourceDirName":".","slug":"/authentication-enhancements","permalink":"/Physical-AI-Humanoid-Robotics-Book/docs/authentication-enhancements","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var t=i(4848),r=i(8453);const l={},o="Authentication Enhancements",a={},c=[{value:"Overview",id:"overview",level:2},{value:"Features Implemented",id:"features-implemented",level:2},{value:"1. Cross-Window State Synchronization",id:"1-cross-window-state-synchronization",level:3},{value:"2. Email Verification Flow",id:"2-email-verification-flow",level:3},{value:"3. Sign Out Confirmation Flow",id:"3-sign-out-confirmation-flow",level:3},{value:"4. Redirect URL Validation",id:"4-redirect-url-validation",level:3},{value:"5. Return URL Functionality",id:"5-return-url-functionality",level:3},{value:"Key Functions",id:"key-functions",level:2},{value:"URL Validation",id:"url-validation",level:3},{value:"Return URL Utilities",id:"return-url-utilities",level:3},{value:"Components",id:"components",level:2},{value:"Sign Out Flow",id:"sign-out-flow",level:3},{value:"Cross-Window Synchronization",id:"cross-window-synchronization",level:3},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Error Handling",id:"error-handling",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"authentication-enhancements",children:"Authentication Enhancements"})}),"\n",(0,t.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(e.p,{children:"This document describes the enhancements made to the authentication system to fix critical issues and improve user experience."}),"\n",(0,t.jsx)(e.h2,{id:"features-implemented",children:"Features Implemented"}),"\n",(0,t.jsx)(e.h3,{id:"1-cross-window-state-synchronization",children:"1. Cross-Window State Synchronization"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Authentication state changes in one browser window/tab are automatically synchronized to all other open windows/tabs"}),"\n",(0,t.jsx)(e.li,{children:"Uses localStorage events to communicate auth state changes between windows"}),"\n",(0,t.jsx)(e.li,{children:"Ensures consistent UI across multiple browser windows when signing in/out or verifying email"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"2-email-verification-flow",children:"2. Email Verification Flow"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Enhanced email verification state management in AuthContext"}),"\n",(0,t.jsx)(e.li,{children:"Success feedback mechanism with temporary success messages"}),"\n",(0,t.jsx)(e.li,{children:"Proper handling of email verification in different windows/tabs"}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"3-sign-out-confirmation-flow",children:"3. Sign Out Confirmation Flow"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:'Modal confirmation dialog before signing out with "Cancel" and "Sign Out" options'}),"\n",(0,t.jsx)(e.li,{children:"Loading state during signout process"}),"\n",(0,t.jsx)(e.li,{children:'Success notification after successful sign out with message "You\'ve been signed out successfully"'}),"\n",(0,t.jsx)(e.li,{children:'Proper handling of cancellation (clicking "Cancel" or outside dialog)'}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"4-redirect-url-validation",children:"4. Redirect URL Validation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Validates only internal URLs starting with ",(0,t.jsx)(e.code,{children:"/"})," are allowed"]}),"\n",(0,t.jsx)(e.li,{children:"Prevents open redirect vulnerabilities (no protocol or domain)"}),"\n",(0,t.jsx)(e.li,{children:"Prevents redirect loops to auth pages (signin/signup)"}),"\n",(0,t.jsx)(e.li,{children:"Implements fallback to default route for invalid URLs"}),"\n",(0,t.jsxs)(e.li,{children:["Uses ",(0,t.jsx)(e.code,{children:"getValidRedirectUrl(url, fallback)"})," function for safe redirects"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"5-return-url-functionality",children:"5. Return URL Functionality"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Captures current page URL when navigating to authentication pages"}),"\n",(0,t.jsxs)(e.li,{children:["Stores return URL in query parameters (e.g., ",(0,t.jsx)(e.code,{children:"?returnUrl=/docs/module4"}),")"]}),"\n",(0,t.jsx)(e.li,{children:"Reads and validates return URL after successful authentication"}),"\n",(0,t.jsx)(e.li,{children:"Preserves query parameters when capturing and returning to original URLs"}),"\n",(0,t.jsx)(e.li,{children:"Handles case where no return URL is provided (redirects to default)"}),"\n",(0,t.jsx)(e.li,{children:"Prevents return URL loops to authentication pages"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"key-functions",children:"Key Functions"}),"\n",(0,t.jsx)(e.h3,{id:"url-validation",children:"URL Validation"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"isValidRedirectUrl(url: string): boolean"})," - Validates if a redirect URL is safe and internal"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"getValidRedirectUrl(url: string | null | undefined, fallback = '/'): string"})," - Validates redirect URL and returns a safe fallback if invalid"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"constructAuthUrlWithReturn(authPath: string, returnUrl?: string): string"})," - Constructs an authentication URL with the return URL as a query parameter"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"return-url-utilities",children:"Return URL Utilities"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"captureReturnUrl(): string"})," - Captures the current page URL to be used as a return URL"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"getReturnUrlFromParams(): string | null"})," - Gets the return URL from query parameters"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"isAuthPage(): boolean"})," - Checks if the current page is an authentication page"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"components",children:"Components"}),"\n",(0,t.jsx)(e.h3,{id:"sign-out-flow",children:"Sign Out Flow"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"SignOutConfirmationDialog"})," - Modal dialog for sign out confirmation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"useSignOutWithConfirmation"})," - Hook that manages sign out state and logic"]}),"\n",(0,t.jsxs)(e.li,{children:["Updated ",(0,t.jsx)(e.code,{children:"UserProfileNavbarItem"}),", ",(0,t.jsx)(e.code,{children:"AuthNavbarItem"}),", and ",(0,t.jsx)(e.code,{children:"LogoutButton"})," components to use the new confirmation flow"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"cross-window-synchronization",children:"Cross-Window Synchronization"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Enhanced ",(0,t.jsx)(e.code,{children:"AuthContext"})," with cross-window state synchronization using localStorage events"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"enhanceAuthStateHandling"})," function in ",(0,t.jsx)(e.code,{children:"supabase.ts"})," for cross-window communication"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Open Redirect Prevention"}),": All redirect URLs are validated to prevent open redirect vulnerabilities"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["Only internal URLs starting with ",(0,t.jsx)(e.code,{children:"/"})," are allowed"]}),"\n",(0,t.jsxs)(e.li,{children:["External protocols (",(0,t.jsx)(e.code,{children:"http:"}),", ",(0,t.jsx)(e.code,{children:"https:"}),") and domains are blocked"]}),"\n",(0,t.jsx)(e.li,{children:"Auth pages are blocked as return URLs to prevent loops"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Cross-Window Security"}),": Auth state is synchronized between windows without exposing sensitive tokens"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Authentication tokens are not stored in localStorage for security"}),"\n",(0,t.jsx)(e.li,{children:"Only auth events and non-sensitive session metadata are synchronized"}),"\n",(0,t.jsx)(e.li,{children:"All sensitive operations happen through the secure Supabase client"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Input Validation"}),": All user-provided URLs are validated before use"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"URL validation occurs on both client and through Supabase's built-in protections"}),"\n",(0,t.jsx)(e.li,{children:"Invalid URLs fall back to safe default routes"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Session Management"}),": Proper session handling across multiple windows/tabs"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Sessions are managed securely by Supabase"}),"\n",(0,t.jsx)(e.li,{children:"Cross-window sync only updates UI state, not session tokens"}),"\n",(0,t.jsx)(e.li,{children:"Sign out operations properly clear sessions in all windows"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Invalid redirect URLs fall back to default routes"}),"\n",(0,t.jsx)(e.li,{children:"Authentication errors are properly caught and displayed"}),"\n",(0,t.jsx)(e.li,{children:"Network failures during auth operations are handled gracefully"}),"\n",(0,t.jsx)(e.li,{children:"Cross-window synchronization errors are logged but don't break functionality"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>l,x:()=>o});var s=i(6540);const t={},r=s.createContext(t);function l(n){const e=s.useContext(r);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);